---
sudo: required
cache:
  directories:
    - $HOME/.ghc
    - $HOME/.cabal
    - $HOME/.atspkg
addons:
  apt:
    packages:
      libgmp3-dev
matrix:
  include:
    - language: c
      addons:
        apt:
          packages:
            - cabal-install-head
            - ghc-8.4.3
          sources:
            - hvr-ghc
    - language: c
      addons:
        apt:
          packages:
            - cabal-install-head
            - ghc-8.2.2
          sources:
            - hvr-ghc
    - language: c
      addons:
        apt:
          packages:
            - cabal-install-head
            - ghc-8.0.2
          sources:
            - hvr-ghc
    - language: c
      addons:
        apt:
          packages:
            - cabal-install-head
            - ghc-7.10.3
          sources:
            - hvr-ghc
    - language: c
      os: osx

install:
  - |
    if [ `uname` = "Darwin" ]
    then
      brew install cabal-install
    else
      export PATH=/opt/ghc/bin:$PATH
    fi
  - cabal update
  - curl -sSl https://raw.githubusercontent.com/vmchale/atspkg/master/bash/install.sh | bash -s

script:
  - |
    if [ `uname` = "Linux" ]
    then
      curl -sL https://raw.githubusercontent.com/vmchale/tomlcheck/master/sh/check | sh -s fast-arithmetic/.atsfmt.toml
    fi
  - cd fast-arithmetic
  - atspkg build --pkg-args "./source.dhall" -vv
  - atspkg test --pkg-args "./bench.dhall" -vv
  - cabal new-build
  - cabal new-test
