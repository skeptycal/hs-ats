---
sudo: required
cache:
  directories:
    - $HOME/.ghc
    - $HOME/.cabal
    - $HOME/.atspkg
addons:
  apt:
    packages:
      libgmp3-dev
matrix:
  include:
    - language: python
      addons:
        apt:
          packages:
            - cabal-install-head
            - ghc-8.4.2
          sources:
            - hvr-ghc
    - env: TARGET=x86_64-apple-darwin
      os: osx
      language: c

install:
  - |
    if [ `uname` = "Darwin" ]
    then
      brew install cabal-install
    else
      export PATH=/opt/ghc/bin:$PATH
    fi
  - cabal update
  - curl -sSl https://raw.githubusercontent.com/vmchale/atspkg/master/bash/install.sh | bash -s

script:
  - |
    if [ `uname` = "Linux" ]
    then
      pip install yamllint
      yamllint .travis.yml
      yamllint .stylish-haskell.yaml
      yamllint .hlint.yaml
      yamllint .yamllint
      curl -sL https://raw.githubusercontent.com/vmchale/tomlcheck/master/sh/check | sh -s fast-arithmetic/.atsfmt.toml
    fi
  - cd fast-arithmetic
  - atspkg build -vv
  - atspkg test
  - cabal new-build
  - cabal new-test
